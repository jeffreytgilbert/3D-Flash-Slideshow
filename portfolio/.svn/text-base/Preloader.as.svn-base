package  {	import flash.display.Shape;	import flash.display.Sprite;	import com.greensock.TweenLite;	import flash.events.Event;	import flash.text.TextField;	import flash.text.TextFormat;	import flash.text.TextFieldAutoSize;		public class Preloader extends Sprite{		private var _throbber:Shape 				= new Shape();		private var _labelTextTF:TextField			= new TextField();		private var _font:FontPixel					= new FontPixel();		private var _format:TextFormat				= new TextFormat();		private var _percentageComplete:Number		= 0;		private var _itemsToLoad:uint				= 0;		private var _itemsFinished:uint				= 0;				public static const LOADING_COMPLETE:String = 'loadingComplete';				public function Preloader() {			// constructor code			_format.font=_font.fontName;			_format.size=8;			_format.color=0x0;						_labelTextTF.autoSize=TextFieldAutoSize.LEFT;			_labelTextTF.defaultTextFormat=_format;			_labelTextTF.embedFonts=true;			_labelTextTF.text='Loading 0%';			_labelTextTF.selectable=false;						_throbber.x=0;			_labelTextTF.x=50;			addChild(_throbber);			addChild(_labelTextTF);			BitmapUtils.colorToShape(0xFF0000,_throbber);			_throbber.width = 1;			_throbber.height = 1;		}				public function registerItem(thumb:Thumbnail):void{			thumb.addEventListener(Thumbnail.THUMBNAIL_READY,updateProgress);			++_itemsToLoad;		}				private function updateProgress(evt:Event):void{			++_itemsFinished;			_percentageComplete = (_itemsFinished/_itemsToLoad);			(evt.currentTarget as Thumbnail).removeEventListener(Thumbnail.THUMBNAIL_READY,updateProgress);			if(_itemsToLoad == _itemsFinished){				_labelTextTF.text='Loading 100%';				TweenLite.to(_throbber,.5,{					width:_percentageComplete * stage.stageWidth, onComplete:function():void{						dispatchEvent(new Event(Preloader.LOADING_COMPLETE,true,true));					}				});			} else {				_labelTextTF.text='Loading '+Math.floor(_percentageComplete*100)+'%';				TweenLite.to(_throbber,.5,{width:_percentageComplete * stage.stageWidth});			}		}				public function updateDisplayList():void{			if(!stage) return;			_throbber.y=Math.floor(stage.stageHeight/2);			_labelTextTF.y=Math.floor((stage.stageHeight/2)+4);			TweenLite.to(_throbber,.5,{width:_percentageComplete * stage.stageWidth});//			_throbber.width = (_itemsToLoad/_itemsFinished) * (stage.stageWidth-100);		}	}}